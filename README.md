# Neural-Network-For-SPY
# ML-Enhanced Trading Analysis System

![Python Version](https://img.shields.io/badge/python-3.8+-blue.svg)
![License](https://img.shields.io/badge/License-MIT-green.svg)
![Pytorch](https://img.shields.io/badge/PyTorch-%23EE4C2C.svg?style=flat&logo=pytorch&logoColor=white)
![Pandas](https://img.shields.io/badge/pandas-%23150458.svg?style=flat&logo=pandas&logoColor=white)

This repository contains an advanced stock analysis tool that combines a sophisticated Deep Learning model (LSTM with Attention) with a robust set of traditional Technical Analysis (TA) indicators.

The core innovation is its **ML-first decision logic**:
*   The **Deep Learning model acts as the primary strategist**, determining the final trading signal (Buy, Sell, or Hold).
*   The **Technical Analysis module acts as a confirmer**, used to intelligently adjust the confidence level of the ML model's decision.

This approach leverages the pattern-recognition capabilities of neural networks for the main signal, while using time-tested indicators to provide context and conviction.


*(Example chart generated by the system for SPY)*

---

## Key Features

-   **Sophisticated ML Model**: Utilizes an LSTM (Long Short-Term Memory) network combined with a Multi-Head Attention mechanism to capture complex temporal patterns in market data.
-   **Comprehensive Feature Engineering**: Calculates over 20 financial indicators, including WMA-based MACD, Stochastics, RSI, Bollinger Bands, ATR, ROC, and moving average slopes.
-   **ML-First Decision Logic**: The neural network's prediction is the final signal. TA is not used to override the signal, but to measure its conviction.
-   **Adaptive Confidence Score**:
    -   When the ML signal and TA signal **agree**, confidence is reinforced.
    -   When they **disagree**, confidence is penalized, flagging a potentially ambiguous market condition.
-   **Trainable on Multiple Assets**: The model can be trained on a diverse basket of stocks (e.g., `AAPL`, `GOOGL`, `MSFT`) to learn more generalized market dynamics.
-   **Detailed Visualization**: Generates a high-quality candlestick chart showing price action, key support/resistance levels, and color-coded trend momentum.
-   **Clear Reporting**: Outputs a clean, detailed terminal report summarizing the ML signal, the TA context, and the final confidence score.

---

## How It Works: The Decision Engine

The system's intelligence comes from its two-part analysis process for generating a final signal.

1.  **The Strategist (ML Model)**:
    -   A sequence of the most recent market data (20 periods) is created, containing over 20 normalized features.
    -   This sequence is fed into the trained `TradingSignalNet` (LSTM + Attention).
    -   The model outputs two things:
        1.  A primary signal: **Buy (0), Hold (1), or Sell (2)**.
        2.  An initial confidence score (0 to 1) based on its internal state.

2.  **The Confirmer (TA Module)**:
    -   A traditional analysis is run on the latest data point, calculating a score-based signal (Buy, Sell, or Hold) from indicators like MACD, Stochastics, and proximity to S/R levels.
    -   This TA signal is compared to the ML signal.

3.  **Final Signal & Confidence Adjustment**:
    -   **The Final Signal is ALWAYS the ML model's signal.**
    -   The Final Confidence is adjusted based on the comparison:
        -   **Agreement**: If `ML_Signal == TA_Signal`, the final confidence is a weighted average that boosts the ML's initial confidence (`final_conf = ml_conf * 0.8 + ta_conf * 0.2`).
        -   **Disagreement**: If `ML_Signal != TA_Signal`, it indicates conflicting information. The final confidence is penalized (`final_conf = ml_conf * 0.7`) to reflect the higher uncertainty.

---

## Installation

1.  **Clone the repository:**
    ```bash
    git clone https://github.com/your-username/your-repo-name.git
    cd your-repo-name
    ```

2.  **Create and activate a virtual environment (recommended):**
    ```bash
    # For Unix/macOS
    python3 -m venv venv
    source venv/bin/activate

    # For Windows
    python -m venv venv
    .\venv\Scripts\activate
    ```

3.  **Install the required libraries:**
    A `requirements.txt` file is the easiest way. Create a file named `requirements.txt` with the following content:
    ```txt
    yfinance
    pandas
    numpy
    matplotlib
    torch
    scikit-learn
    ```
    Then, install the dependencies from the file:
    ```bash
    pip install -r requirements.txt
    ```

---

## Usage

The script can be run directly from the command line. The main execution is controlled by the `run_analysis` function at the bottom of the script.

### 1. Training the Model (First-Time Use)

To get the best results, you should train the model first. This will download data for a basket of stocks, train the network, and save the best model weights to a file named `best_trading_model.pth`.

To do this, ensure the `train_first` parameter is set to `True` in the main execution block:
```python
if __name__ == "__main__":
    # This will train the model and then run an analysis on "SPY"
    run_analysis("SPY", train_first=True, epochs=50)

This process can take several minutes depending on your hardware.
---

### 2. Running Analysis with a Pre-Trained Model
Once the `best_trading_model.pth` file exists, you can quickly analyze any ticker by setting `train_first=False`.

```python
if __name__ == "__main__":
    # This will load the existing model and run an analysis on "TSLA"
    run_analysis("TSLA", train_first=False)

### Sample Output
Running the analysis will produce a detailed report in your terminal and display a chart.

**Terminal Report:**
```text
======================================================================
ML-ENHANCED TRADING ANALYSIS: SPY
======================================================================
  FINAL SIGNAL:              BUY (Decision by ML Model)
  FINAL CONFIDENCE:          75.4% (Reinforced by TA)
----------------------------------------------------------------------
  --- ML Model Analysis (Primary) ---
  ML Signal:                 BUY
  ML Confidence:             85.1%

  --- Traditional Analysis (Fine-Tuning) ---
  Traditional Signal:        BUY
  Traditional Confidence:    67.0%
  Signals Agreement:         True
  Current Price:             $450.12
  Nearest S/R Level:         $445.80 (1.0% away)
  Stochastic %K:             25.31
  Volatility Expansion:      -15.20%
  Trend (20D/40D/200D):      up/up/up
  MACD Hist Momentum:        Rising
======================================================================
